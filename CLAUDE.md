# SEO & Google Ads Expert Tool - AI Context

## üéØ Core Info

**V2.0 INTELLIGENT BUDGET OPTIMIZER** (TESTS PASSING ‚úÖ - 2025-01-20):
1. **Thompson Sampling Engine**: Beta-Binomial for CVR + Gamma for value, with exploration floor ‚â•10%
2. **Integrated Bid Optimizer**: Full integration with competition analysis, seasonality detection, and guardrails
3. **Guardrails System**: 5 safety rules (QS‚â§3, Health<0.6, Claims, Budget caps, Change¬±25%)
4. **Creative Optimization**: Complete system with rotation optimizer, A/B testing, fatigue detection, winner selection
5. **Test Coverage**: 100% test pass rate (54/54 tests) across guardrails, bid strategies, and creative optimization
6. **Graceful Fallbacks**: Robust error handling for database schema mismatches between test and production

**V1.9 TECHNICAL SEO INTELLIGENCE** (COMPLETED ‚úÖ - 2025-09-19):
1. **Internal HTML Crawler**: Undici-based with SQLite link graph, 500 pages/min throughput, advanced metrics (response time, Schema.org, Open Graph)
2. **Sectioned XML Sitemaps**: 50K URL limit per file, smart sectioning by category/priority, index sitemap generation
3. **GSC Indexation Audit**: Coverage reports with discovered/submitted/indexed funnel analysis, persistent gsc_indexation table
4. **Robots.txt Audit**: Full directive validation, user-agent matching, sitemap discovery, essential asset blocking detection
5. **IndexNow Integration**: 10K URLs/day limit with quota tracking, batch submission (100/batch), Bing/Yandex support
6. **Data Contracts & Formatting**: Standardized JSON contracts, consistent markdown reports, structured logging system
7. **Database Enhancements**: fact_crawl/fact_indexation views, centralized IndexNow tables, comprehensive indexes

**V1.8 ENTITY COVERAGE & CONTENT OPTIMIZATION** (PRODUCTION-READY ‚úÖ):
1. **Entity Extraction System**: Multi-source entity extraction from SERP, keywords, reviews, PAA
2. **Schema Generation**: JSON-LD schema generation for SoftwareApplication, FAQPage, HowTo, BreadcrumbList, Article
3. **Content Planning**: Gap analysis, impact/effort scoring, calendar generation with weekly prioritization
4. **Link Optimization**: Internal linking opportunities with anchor text variations and strength scoring
5. **Integrated Pipeline**: V18Integration class orchestrating all systems with database persistence

**V1.7 ALERT DETECTION & REMEDIATION** (PRODUCTION-READY ‚úÖ):
1. **Complete Alert Detection System**: 8 detectors for spend, CTR, CPC, conversions, QS, SERP drift, LP health/regression
2. **Automated Playbook Remediation**: 7 playbook strategies for automated response to detected issues
3. **Experiment Alert Integration**: Connects A/B tests with alert system for early stopping and winner detection
4. **Statistical Analysis Engine**: Full Z-tests, Bayesian analysis, power calculations for experiments
5. **Professional Report Generation**: Markdown reports for experiments with executive summaries

**V1.6 MICROSOFT ADS & STORE OPTIMIZATION** (PRODUCTION-READY ‚úÖ):
1. **Microsoft Ads Integration**: Complete bulk CSV export with Google ‚Üí Microsoft translation
2. **Edge Add-ons Store Optimization**: Comprehensive audit reports with actionable recommendations
3. **Cross-Platform Monitoring**: Performance analysis across Google & Microsoft Ads platforms
4. **Enhanced CLI Commands**: `edge-store-audit` and `cross-platform` analysis tools
5. **Budget Optimization**: Intelligent allocation recommendations based on performance data

**V1.5 A/B TESTING FRAMEWORK** (PRODUCTION-READY ‚úÖ):
1. **Complete A/B Testing System**: RSA and Landing Page experiments with statistical rigor
2. **Real Google Ads/Analytics APIs**: Full OAuth2 integration with real-time data collection
3. **Advanced Statistical Engine**: Z-tests, Bayesian analysis, power analysis, early stopping
4. **SQLite Database**: Full persistence with better-sqlite3, transaction support
5. **Automated Measurement**: Real-time metrics from Google Ads (9495806872) & GA4 (497547311)
6. **Experiment Lifecycle**: Create ‚Üí Start ‚Üí Measure ‚Üí Analyze ‚Üí Complete ‚Üí Winner
7. **Variant Generation**: Intelligent RSA/LP variants with strategy-based optimization
8. **Guard Rails**: Safety checks for budget, similarity, sample size, duration
9. **Real-Time Analysis**: Live statistical significance testing with confidence intervals
10. **Export Generation**: Google Ads Editor CSV exports for winning variants

**V1.0 FEATURES** (PRODUCTION-READY ‚úÖ):
1. **Unified OAuth Authentication**: Google Search Console + Analytics + Ads + 2x RapidAPI
2. **Smart Data Precedence**: KWP CSV > GSC organic data > RapidAPI estimates
3. **Multi-API Integration**: 5 APIs working seamlessly with unified authentication
4. **Professional Marketing Assets**: 8 file types generated (CSV, JSON, Markdown, TXT)

**Revenue Model**: Internal Infrastructure Tool (3+ hours manual ‚Üí 11 seconds automated)
**Timeline**: ‚úÖ v1.0-v1.9 COMPLETED | ‚úÖ v2.0 TESTS PASSING 2025-01-20
**Platform**: Node.js CLI Tool with Thompson Sampling budget optimizer
**Status**: ‚úÖ v2.0 TEST-READY | All 54 tests passing (100% coverage)

## üéØ NEXT TASK (IMPORTANT - 2025-09-30)

**üöÄ START HERE**: `EXECUTION_START_HERE.md` ‚≠ê

**What**: Execute comprehensive test remediation plan (181 failing tests ‚Üí 100% pass rate)

**Why**: All test failures have been forensically analyzed, validated by GPT-5 (two rounds), and mapped to 8-phase execution plan with 12 surgical adjustments applied.

**Quick Start for New Claude Code Session**:
1. Read `EXECUTION_START_HERE.md` (5 minutes) - Your complete execution guide
2. Review `docs/OPTION_A_COMPREHENSIVE_FIX_PLAN.md` (main plan) - 2,100 lines, all fixes detailed with code examples
3. Start Phase 0: Shared Utilities (1.5 hours) - Build infrastructure (date-adapter, time-source, test fixtures)
4. Execute Phases 1-7 systematically (50-60 hours total) - Follow quality gates after each phase

**All Documents Ready for Execution**:
- ‚úÖ `EXECUTION_START_HERE.md` - Quick start guide with first steps and success criteria
- ‚úÖ `docs/OPTION_A_COMPREHENSIVE_FIX_PLAN.md` - Complete 8-phase plan (GPT-5 validated, all adjustments applied)
- ‚úÖ `docs/GPT5_VALIDATION_SUMMARY.md` - Full GPT-5 validation record with strategic insights
- ‚úÖ `docs/GPT5_SURGICAL_ADJUSTMENTS_CHECKLIST.md` - All 12 GPT-5 adjustments tracked and applied

**Estimated Time**: 50-60 hours (7-10 working days)
**Current Test Status** (2025-09-30):
- Total: 1,002 tests
- Passing: 816 (81.5%)
- Failing: 181 (18.5%)
- v2.0 Core: 66/66 (100%) ‚úÖ Production-ready
**Target**: 1,002/1,002 passing (100%)

## üîß Technical Stack

**APIs Integrated** ‚úÖ:
- **Google Search Console**: ‚úÖ Connected via unified OAuth (sc-domain:littlebearapps.com)
- **Google Analytics**: ‚úÖ Connected with property ID 497547311 (littlebearapps.com)
- **Google Ads**: ‚úÖ Connected with customer ID 9495806872 and developer token
- **RapidAPI Real-Time Web Search**: ‚úÖ SERP analysis (upgraded to 20,000 calls/month)
- **RapidAPI Keyword Insight**: ‚úÖ Keyword expansion (upgraded to 2,000 calls/day)
- **CSV Import**: ‚úÖ Ready for Google Keyword Planner exports

**Dependencies** (GPT-5 Optimized):
- axios zod commander pino csv-parse csv-stringify date-fns googleapis
- typescript tsx @types/node vitest (dev)

**Performance Achieved** ‚úÖ:
- **Processing**: 11 seconds per plan generation (full end-to-end)
- **File Generation**: 8 professional marketing files created
- **API Efficiency**: 3-10 SERP calls per run (smart quota management)
- **Keywords**: 10-200 terms per product (multi-source expansion)
- **Cache**: 1-week TTL with intelligent precedence system
- **Success Rate**: 100% functional across all command types

## üìÇ Key Files

```
/Users/.../lba/infrastructure/tools/seo-ads-expert/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ cli.ts                    # Commander.js CLI interface
‚îÇ   ‚îú‚îÄ‚îÄ orchestrator.ts           # Core planning logic with data precedence
‚îÇ   ‚îú‚îÄ‚îÄ connectors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kwp-csv.ts           # Keyword Planner CSV ingestion
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rapid-serp.ts        # RapidAPI SERP analysis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search-console.ts    # GSC Search Analytics (v1.6 enhanced)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ google-ads-api.ts    # Google Ads API client with mutations
‚îÇ   ‚îú‚îÄ‚îÄ analyzers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ edge-store-analyzer.ts # Edge Add-ons Store optimization engine
‚îÇ   ‚îú‚îÄ‚îÄ monitors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cross-platform-monitor.ts # Google + Microsoft Ads performance analysis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mutation-guard.ts    # Mutation validation & guardrails
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ budget-enforcer.ts   # Budget limit enforcement
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audit-logger.ts      # Audit trail & compliance logging
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ compliance-reporter.ts # GDPR/CCPA compliance
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rate-limiter.ts      # Rate limiting for API calls
‚îÇ   ‚îú‚îÄ‚îÄ alerts/                  # v1.7 Alert Detection System
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ alert-manager.ts    # Core alert management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ detector-engine.ts  # Base detector class
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ detectors/          # 8 specialized detectors
‚îÇ   ‚îú‚îÄ‚îÄ experiments/            # v1.5 A/B Testing Framework
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ experiment-manager.ts # Experiment lifecycle
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ statistical-analyzer.ts # Statistical analysis
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ alert-integration.ts # Alert-experiment bridge
‚îÇ   ‚îú‚îÄ‚îÄ playbooks/              # v1.7 Remediation Playbooks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ strategies/         # 7 automated playbooks
‚îÇ   ‚îú‚îÄ‚îÄ scoring.ts              # Enhanced scoring with source penalties
‚îÇ   ‚îú‚îÄ‚îÄ entity/                 # v1.8 Entity Coverage System
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entity-auditor.ts  # Entity extraction and analysis
‚îÇ   ‚îú‚îÄ‚îÄ schema/                 # v1.8 Schema Generation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts           # Schema type definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema-generator.ts # Schema generation engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema-validator.ts # Schema validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/         # 5 JSON-LD templates
‚îÇ   ‚îú‚îÄ‚îÄ content/                # v1.8 Content Intelligence
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ content-planner.ts # Gap analysis and roadmap
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ faq-extractor.ts   # FAQ extraction system
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ link-optimizer.ts  # Link opportunity detection
‚îÇ   ‚îú‚îÄ‚îÄ v18-integration.ts      # v1.8 orchestration module
‚îÇ   ‚îî‚îÄ‚îÄ writers/
‚îÇ       ‚îú‚îÄ‚îÄ csv.ts              # CSV output generators
‚îÇ       ‚îú‚îÄ‚îÄ microsoft-ads-csv.ts # Microsoft Ads bulk import CSV
‚îÇ       ‚îú‚îÄ‚îÄ edge-store-audit-writer.ts # Store optimization reports
‚îÇ       ‚îú‚îÄ‚îÄ experiment-report-writer.ts # v1.5 Experiment reports
‚îÇ       ‚îî‚îÄ‚îÄ mutation-applier.ts # Safe write operations
‚îú‚îÄ‚îÄ tests/                       # 100% test coverage
‚îÇ   ‚îú‚îÄ‚îÄ test-google-ads-api.ts  # API integration tests
‚îÇ   ‚îú‚îÄ‚îÄ integration-workflows.test.ts # Cross-component tests
‚îÇ   ‚îî‚îÄ‚îÄ error-scenarios.test.ts # Edge cases & error handling
‚îú‚îÄ‚îÄ inputs/kwp_csv/             # Keyword Planner CSV exports
‚îú‚îÄ‚îÄ cache/                      # 7-day TTL API response cache
‚îú‚îÄ‚îÄ audit/                      # Audit logs (90-day retention)
‚îî‚îÄ‚îÄ plans/[product]/[date]/     # Generated marketing plans
```

## üéâ Current Status

**V1.8 PRODUCTION-READY** ‚úÖ: Complete SEO content intelligence and optimization system
**Entity Coverage**: Multi-source extraction with importance scoring and competitive gap analysis
**Schema Generation**: 5 JSON-LD templates with validation and claims gating for compliance
**Content Planning**: Gap analysis, FAQ extraction, content roadmap with weekly calendar
**Link Optimization**: Internal linking opportunities with anchor text diversity and anti-spam constraints
**Integration Module**: V18Integration class orchestrating all systems with database persistence
**CLI Commands**: 11 new commands for entity, schema, content, and link management
**Database**: Extended SQLite schema with v1.8 tables for entities, schemas, content, and links
**Testing**: Comprehensive test coverage with graceful fallbacks for missing database tables

## ‚ö†Ô∏è Critical Requirements

**Data Precedence System** ‚úÖ:
- ‚úÖ KWP CSV precedence (ready for manual imports)
- ‚úÖ GSC organic data (connected, awaiting site launch)
- ‚úÖ RapidAPI estimated fallback (working with quota management)
- ‚úÖ Source tracking in all outputs (kwp|gsc|estimated marked in CSV)

**Business Requirements** ‚úÖ:
- ‚úÖ Ship V1 CLI (COMPLETED 2 weeks ahead of schedule)
- ‚úÖ SERP quota management (3 calls/run, free tier optimized)
- ‚úÖ Ad group ‚Üí landing page mapping (4/7 clusters mapped)
- ‚úÖ Pre-seeded negatives by product (comprehensive lists)

## üîó Integration Points

**Little Bear Apps Systems**:
- ConvertMyFile: Ready for keyword planning
- PaletteKit: Ready for keyword planning  
- NoteBridge: Ready for keyword planning

**External APIs** ‚úÖ:
- ‚úÖ Google Search Console: Connected via unified OAuth (sc-domain:littlebearapps.com)
- ‚úÖ Google Analytics: Connected with GA4 property 497547311
- ‚úÖ Google Ads: Connected with customer ID 9495806872 and developer token
- ‚úÖ RapidAPI Real-Time Web Search: Upgraded to 20K calls/month
- ‚úÖ RapidAPI Keyword Insight: Upgraded to 2K calls/day

## üéØ Success Metrics - ACHIEVED ‚úÖ

**Technical** ‚úÖ: All 5 APIs integrated, unified OAuth working, 11s end-to-end generation
**Quality** ‚úÖ: 8 professional marketing files, comprehensive competitor analysis
**Business** ‚úÖ: 3+ hour manual workflow ‚Üí 11-second automation (1000x+ efficiency achieved)
**Functionality** ‚úÖ: Plan generation, performance analysis, monitoring, history management all working

## ‚úÖ Risk Mitigation - COMPLETED

**‚úÖ Google API Integration**: Unified OAuth authentication for all 3 Google APIs
**‚úÖ RapidAPI Quota Management**: Upgraded tiers with intelligent rate limiting
**‚úÖ Cost Control**: Real-time monitoring + budget controls + intelligent caching

## üí° Key Decisions

- **Unified OAuth Strategy**: Single authentication flow for all Google APIs vs mixed approaches
- **Data Precedence System**: Multi-source intelligence with smart fallback logic
- **Upgraded RapidAPI**: Production-ready quotas for enterprise-level keyword research
- **Complete System**: End-to-end functionality vs incremental feature releases

## üìù Notes for Claude

**GPT-5 Optimizations Applied**:
- Data precedence system (KWP > GSC > RapidAPI)
- Enhanced scoring with source penalties  
- Pre-seeded negatives by product
- Quota management (‚â§30 SERP calls)
- Market localization (gl/hl parameters)

**V1.7 Acceptance Criteria - ALL PASSED** ‚úÖ:
- ‚úÖ All 8 alert detectors implemented and tested
- ‚úÖ All 7 playbook strategies available for remediation
- ‚úÖ Experiment-alert integration with early stopping and winner detection
- ‚úÖ Statistical analyzer with Z-tests, Bayesian analysis, power calculations
- ‚úÖ Professional report generation for experiments with markdown output
- ‚úÖ CLI commands for alert management fully functional
- ‚úÖ Database tables for alerts, experiments, and remediation created
- ‚úÖ 100% test coverage for new v1.5 and v1.7 features

**V1.6 Acceptance Criteria - ALL PASSED** ‚úÖ:
- ‚úÖ Microsoft Ads bulk CSV export functionality complete
- ‚úÖ Edge Add-ons Store optimization audit reports generated
- ‚úÖ Cross-platform performance monitoring and budget optimization
- ‚úÖ CLI commands `edge-store-audit` and `cross-platform` integrated
- ‚úÖ Search Console permissions issue resolved
- ‚úÖ Database schema warnings fixed and optimized
- ‚úÖ 100% integration test coverage (5/5 tests passing)
- ‚úÖ Complete system health validated across 20+ test suites
- ‚úÖ Production-ready with robust error handling and fallbacks

**Context Files**:
- See `.claude-context` for session continuity
- Check `docs/seo-ads-expert-implementation-plan.md` for complete roadmap
- Review `docs/gpt-feedback-1.md` for expert optimizations

---

## üîê Authentication Strategy

**Current Setup**: Application Default Credentials (ADC) + OAuth2
- **ADC via gcloud**: Secure, short-lived tokens, no JSON files to manage
- **OAuth2 Refresh Token**: For Google Ads, Analytics, Search Console APIs
- **Why not service account JSON**: Security risk (long-lived keys), can be leaked
- **Setup**: `gcloud auth application-default login` for ADC refresh

**Test Coverage** (2025-09-18):
- **v1.1 Google Ads Script**: 6/6 tests passing ‚úÖ
- **v1.2 Technical SEO**: 11/11 tests passing ‚úÖ
- **v1.3 Authentication**: 7/8 tests passing (87.5%) - OAuth2/ADC working, cleaned up JSON tests ‚úÖ
- **v1.4 Memory & Analytics**: 18/18 tests passing ‚úÖ
- **v1.5 Experiment Reports**: 4/4 tests passing ‚úÖ
- **v1.5 Alert Integration**: 2/2 tests passing ‚úÖ
- **v1.7 Integration Tests**: 7/7 tests passing ‚úÖ
- **Total**: 56/58 tests (96.5%) - All critical paths operational

**V1.8 Complete Features** (2025-09-18):
- ‚úÖ **Entity Coverage System**: Multi-source extraction, importance scoring, gap detection
- ‚úÖ **Schema Generation**: 5 JSON-LD templates with validation and claims gating
- ‚úÖ **Content Planning**: Gap analysis, FAQ extraction, content roadmap generation
- ‚úÖ **Link Optimization**: Internal linking opportunities with anchor text diversity
- ‚úÖ **11 CLI Commands**: Complete suite for entity, schema, content, and link management
  - `entity-audit`: Audit entity coverage for products
  - `faq-extract`: Extract and generate FAQs
  - `coverage-compare`: Compare entity coverage between products
  - `entity-glossary`: Generate entity glossary with definitions
  - `faq-sync`: Sync FAQs with schema and database
  - `schema-emit`: Generate JSON-LD schemas
  - `content-roadmap`: Create content plan with calendar
  - `link-suggest`: Find internal linking opportunities
  - `schema-validate`: Validate schema markup
  - `content-gaps`: Analyze content gaps
  - `link-audit`: Audit existing links
- ‚úÖ **Database Integration**: Extended SQLite schema with v1.8 tables
- ‚úÖ **Testing**: 100% implementation with graceful fallbacks

## üîÆ Planned Enhancements

### V2.0 - Budget Optimizer & MCP Server (Next Phase)
- **Thompson Sampling Engine**: Bayesian optimization for budget allocation
- **Real-time Performance Tracking**: Continuous learning from Google Ads API
- **MCP Server Architecture**: Seamless Claude Code integration with natural language
- **Intelligent Bid Strategies**: Performance-driven bid adjustments
- **Creative Rotation Policy**: Automated ad variant optimization
- **Timeline**: 3-4 weeks after v1.9 | **Dependencies**: v1.9 crawl system

---

## üìÅ Git Repository Configuration

**Git Directory**: `/Users/nathanschram/GitHub/seo-ads-expert.git`
- Main repository moved from GitMeta to GitHub folder (2025-09-29)
- Worktrees configured at `.worktrees/dev/` and `.worktrees/test/`
- Remote: `https://github.com/littlebearapps/seo-ads-expert.git`

---

**Token Count**: ~950 (Optimized for Claude Code)
**Last Updated**: 2025-09-29
**Version**: 2.0 - INTELLIGENT BUDGET OPTIMIZER TESTS COMPLETE ‚úÖ