# SEO Ads Expert v1.8 Implementation Plan: Entity Coverage, Schema & Content Roadmap

## Executive Summary
v1.8 focuses on organic SEO optimization through entity gap analysis, structured data generation, and content planning. This builds on the existing infrastructure to analyze topical coverage against SERP leaders, generate validated JSON-LD schema, and produce prioritized content roadmaps with internal linking strategies.

**Effort**: 3-5 days  
**Risk**: Low (builds on existing v1.0-1.7 infrastructure)  
**Value**: Raise organic ceiling through comprehensive entity coverage and schema optimization

## 1. Technical Architecture

### 1.1 Core Components (New)

```
src/
├── entity/
│   ├── entity-auditor.ts         # Entity extraction and coverage analysis
│   ├── entity-scorer.ts          # Importance scoring algorithm
│   ├── coverage-analyzer.ts      # Gap detection and recommendations
│   └── types.ts                  # Entity-related type definitions
├── schema/
│   ├── schema-generator.ts       # JSON-LD schema generation
│   ├── schema-validator.ts       # Schema validation and linting
│   ├── templates/
│   │   ├── software-application.ts
│   │   ├── faq-page.ts
│   │   ├── how-to.ts
│   │   ├── breadcrumb-list.ts
│   │   └── article.ts
│   └── types.ts                  # Schema type definitions
├── content/
│   ├── content-planner.ts        # Content roadmap generation
│   ├── link-optimizer.ts         # Internal linking opportunities
│   ├── faq-extractor.ts          # FAQ bank creation from SERP/PAA
│   └── calendar-generator.ts     # Prioritized content calendar
└── cli-entity.ts                 # Entity audit CLI commands
```

### 1.2 Database Schema (Additions)

```sql
-- Entity dimension table
CREATE TABLE IF NOT EXISTS dim_entity (
  entity_id INTEGER PRIMARY KEY AUTOINCREMENT,
  product_id INTEGER NOT NULL,
  canonical TEXT NOT NULL,
  variants_json TEXT NOT NULL, -- JSON array of variant forms
  importance REAL DEFAULT 0.0,  -- 0-1 importance score
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(product_id, canonical)
);

-- Page content snapshot for coverage analysis
CREATE TABLE IF NOT EXISTS fact_page_snapshot (
  captured_at TEXT NOT NULL,
  page_url TEXT NOT NULL,
  word_count INTEGER,
  headings_json TEXT,           -- JSON array of headings
  sections_json TEXT,           -- JSON array of detected sections
  present_entities_json TEXT,   -- JSON array of present entities
  schema_types_json TEXT,       -- JSON array of detected schema types
  content_hash TEXT,            -- Hash for change detection
  PRIMARY KEY (captured_at, page_url)
);

-- Entity coverage tracking
CREATE TABLE IF NOT EXISTS fact_entity_coverage (
  measured_at TEXT NOT NULL,
  product TEXT NOT NULL,
  cluster TEXT NOT NULL,
  market TEXT NOT NULL,
  coverage_score REAL,          -- 0-100 coverage score
  competitor_avg REAL,
  gap_count INTEGER,
  recommendations_json TEXT,    -- JSON array of recommendations
  PRIMARY KEY (measured_at, product, cluster, market)
);

-- Content calendar entries
CREATE TABLE IF NOT EXISTS fact_content_calendar (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  product TEXT NOT NULL,
  priority INTEGER,
  type TEXT,                    -- LP update, blog, pillar
  title TEXT,
  target_url TEXT,
  cluster TEXT,
  market TEXT,
  impact_score REAL,
  effort_score INTEGER,
  status TEXT DEFAULT 'pending',
  due_date TEXT,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

-- Internal linking opportunities
CREATE TABLE IF NOT EXISTS fact_link_opportunities (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  source_url TEXT NOT NULL,
  anchor_text TEXT NOT NULL,
  target_url TEXT NOT NULL,
  rationale TEXT,
  strength INTEGER,             -- 1-3 strength score
  applied BOOLEAN DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_entity_product ON dim_entity(product_id);
CREATE INDEX IF NOT EXISTS idx_snapshot_url ON fact_page_snapshot(page_url);
CREATE INDEX IF NOT EXISTS idx_coverage_product ON fact_entity_coverage(product, cluster);
CREATE INDEX IF NOT EXISTS idx_calendar_priority ON fact_content_calendar(priority, status);
CREATE INDEX IF NOT EXISTS idx_links_source ON fact_link_opportunities(source_url);
```

### 1.3 Integration Points (Reusing Existing)

**Data Sources (Already Available)**:
- `keywords.csv` - Volume, intent, cluster data
- `competitors.md` - Competitor analysis
- `fact_serp_snapshot` - SERP features and top domains (from v1.7)
- `fact_url_health` - URL health status (from v1.7)
- Existing site maps and URL structure

**Output Writers (Reuse)**:
- CSV writers for structured data export
- Markdown generators for reports
- JSON formatters for schema output

## 2. Entity Auditor Implementation

### 2.1 Entity Extraction Algorithm

```typescript
interface EntityExtractor {
  // Extract entities from multiple sources
  extractFromSERP(serpData: any): Entity[];
  extractFromKeywords(keywords: string[]): Entity[];
  extractFromReviews(reviews: any[]): Entity[];
  extractFromPAA(questions: string[]): Entity[];
  
  // Normalize and deduplicate
  normalize(entities: Entity[]): Entity[];
  mapSynonyms(entity: string): string[];
  
  // Score importance
  calculateImportance(entity: Entity): number;
}
```

### 2.2 Coverage Scoring Formula

```typescript
// Coverage score calculation (0-100)
function calculateCoverageScore(
  page: PageSnapshot,
  cluster: Cluster
): number {
  const entityScore = 60 * calculateEntityPresence(page, cluster);
  const sectionScore = 20 * calculateSectionScore(page);
  const schemaScore = 20 * calculateSchemaScore(page);
  
  return Math.min(100, entityScore + sectionScore + schemaScore);
}

// Entity importance formula
function calculateImportance(entity: Entity): number {
  const serpFrequency = 0.5 * getFrequencyInSERP(entity);
  const queryVolume = 0.3 * getWeightedQueryVolume(entity);
  const intentBoost = 0.2 * getIntentBoost(entity);
  
  return serpFrequency + queryVolume + intentBoost;
}
```

### 2.3 Gap Detection Logic

```typescript
interface GapDetector {
  detectMissingEntities(page: PageSnapshot, cluster: Cluster): Entity[];
  detectMissingSections(page: PageSnapshot, competitors: PageSnapshot[]): Section[];
  detectSchemaOpportunities(page: PageSnapshot): SchemaType[];
  
  generateRecommendations(gaps: Gap[]): Recommendation[];
}
```

## 3. Schema Generation System

### 3.1 Schema Templates

```typescript
// Base schema interface
interface SchemaTemplate {
  type: string;
  generate(data: any): JsonLD;
  validate(schema: JsonLD): ValidationResult;
}

// Supported schema types
enum SchemaType {
  SoftwareApplication = 'SoftwareApplication',
  FAQPage = 'FAQPage',
  HowTo = 'HowTo',
  BreadcrumbList = 'BreadcrumbList',
  Article = 'Article'
}
```

### 3.2 Schema Validation Rules

```typescript
interface SchemaValidator {
  // Structural validation
  validateRequired(schema: JsonLD): boolean;
  validateTypes(schema: JsonLD): boolean;
  validateLengths(schema: JsonLD): boolean;
  
  // Content validation
  validateClaims(schema: JsonLD): boolean;
  validateURLHealth(schema: JsonLD): boolean;
  checkDuplicates(schemas: JsonLD[]): boolean;
  
  // Claims validation integration
  applyClaimsGate(schema: JsonLD): JsonLD; // Remove forbidden claims
  
  // Generate lint report
  lint(schemas: JsonLD[]): LintReport;
}

// Claims validation gate rules
const CLAIMS_GATES = {
  'no uploads': 'privacy_friendly', // Map forbidden claim to allowed equivalent
  'offline': 'local_processing',
  'secure': 'privacy_first'
};

// Schema-specific validation rules
const VALIDATION_RULES = {
  SoftwareApplication: {
    required: ['@context', '@type', 'name', 'applicationCategory'],
    maxLengths: { name: 60, description: 160 },
    claims: ['privacy', 'performance', 'compatibility']
  },
  FAQPage: {
    required: ['@context', '@type', 'mainEntity'],
    minQuestions: 2,
    maxQuestionLength: 120,
    noDuplicateQuestions: true
  }
};
```

## 4. Content Planning Engine

### 4.1 Content Calendar Generation

```typescript
interface ContentPlanner {
  // Analyze gaps and generate content plan
  analyzeGaps(coverage: CoverageReport): ContentGap[];
  
  // Prioritize content creation
  prioritizeContent(gaps: ContentGap[]): ContentItem[];
  
  // Calculate impact and effort scores
  calculateImpact(item: ContentItem): number;
  estimateEffort(item: ContentItem): number;
  
  // Generate calendar
  generateCalendar(items: ContentItem[]): ContentCalendar;
}

// Impact score formula
function calculateImpactScore(item: ContentItem): number {
  const intentWeight = 0.5 * getClusterIntentWeight(item.cluster);
  const entityGap = 0.3 * getEntityImportanceGap(item.entities);
  const serpBoost = 0.2 * getSERPFeatureBoost(item.features);
  
  return (intentWeight + entityGap + serpBoost) * 100;
}
```

### 4.2 Internal Link Optimizer

```typescript
interface LinkOptimizer {
  // Find linking opportunities
  findOpportunities(
    sourcePage: Page,
    targetPages: Page[]
  ): LinkOpportunity[];
  
  // Score link strength
  calculateStrength(link: LinkOpportunity): number;
  
  // Generate anchor text variations
  generateAnchors(entity: Entity): string[];
  
  // Apply limits and diversity
  applyConstraints(links: LinkOpportunity[]): LinkOpportunity[];
}
```

## 5. CLI Commands

### 5.1 New Commands

```bash
# Entity audit - analyze coverage gaps
seo-ads entity-audit --product convertmyfile --markets AU,US,GB

# Schema generation with validation
seo-ads schema-emit --product convertmyfile --validate

# Content roadmap generation
seo-ads content-roadmap --product convertmyfile --limit 20

# Internal link suggestions
seo-ads link-suggest --product convertmyfile --min-strength 2

# FAQ bank extraction
seo-ads faq-extract --product convertmyfile --source serp,reviews,paa

# Coverage comparison
seo-ads coverage-compare --product convertmyfile --vs competitors

# Optional: Entity glossary generation
seo-ads entity-glossary --product convertmyfile

# Optional: FAQ sync to landing pages
seo-ads faq-sync --product convertmyfile --target-file content/webp-to-png.md
```

### 5.2 Integration with Existing Commands

```typescript
// Extend plan generation to include entity coverage
program
  .command('plan')
  .option('--include-entities', 'Include entity coverage analysis')
  .option('--generate-schema', 'Generate JSON-LD schema')
  .option('--content-roadmap', 'Generate content calendar')
```

## 6. Implementation Tasks

### Phase 1: Entity Auditor (Day 1)
1. ✅ Create database schema for entities and snapshots
2. ✅ Implement EntityExtractor for multi-source extraction
3. ✅ Build importance scoring algorithm
4. ✅ Create CoverageAnalyzer for gap detection
5. ✅ Implement entity normalization and synonym mapping
6. ✅ Add CLI entity-audit command

### Phase 2: Schema Generator (Day 2)
1. ✅ Create schema template classes for 5 types
2. ✅ Implement SchemaGenerator with template engine
3. ✅ Build SchemaValidator with comprehensive rules
4. ✅ Add claims validation integration
5. ✅ Create schema linting and reporting
6. ✅ Add CLI schema-emit command

### Phase 3: Content Planner (Day 3)
1. ✅ Build ContentPlanner with gap analysis
2. ✅ Implement impact/effort scoring
3. ✅ Create calendar generation with prioritization
4. ✅ Build FAQ bank extractor from SERP/PAA
5. ✅ Add CLI content-roadmap command

### Phase 4: Link Optimizer (Day 4)
1. ✅ Create LinkOptimizer for opportunity detection
2. ✅ Implement anchor text generation
3. ✅ Build strength scoring algorithm
4. ✅ Add constraints and anti-spam limits
5. ✅ Add CLI link-suggest command

### Phase 5: Integration & Testing (Day 5)
1. ✅ Connect to existing data sources
2. ✅ Create comprehensive test suite
3. ✅ Performance optimization (<60s warm, <120s cold)
4. ✅ Documentation updates
5. ✅ Production deployment preparation
6. ✅ **Optional: Entity glossary page generator** (auto-generated per product)
7. ✅ **Optional: FAQ bank sync helper** (MD/MDX insertion tool)

## 7. Output Artifacts

### 7.1 coverage_gaps.md Structure

```markdown
# Coverage Gap Analysis - ConvertMyFile

## Cluster: webp-to-png

**Coverage Score**: 65/100 (Competitor Avg: 82)

### Missing Entities
- High Priority: offline conversion, batch processing, transparency support
- Medium Priority: metadata preservation, color profile

### Missing Sections
- ❌ FAQ section (3+ common questions)
- ❌ How-to guide with steps
- ❌ Comparison table (WebP vs PNG)
- ⚠️ Testimonials/proof (minimal)

### Recommendations
1. **Update Landing Page** (/convertmyfile/webp-to-png)
   - Add FAQ section with 5 PAA questions
   - Include step-by-step guide
   - Add comparison table

2. **New Blog Post**: "WebP vs PNG: Complete Guide"
   - Target 2000+ words
   - Include all missing entities
   - Link to main converter page
```

### 7.2 content_calendar.csv

```csv
priority,type,title,target_url,cluster,market,impact_score,effort,status,due_date
1,LP update,Add FAQ to WebP converter,/convertmyfile/webp-to-png,webp-to-png,US,85,2,pending,2025-09-15
2,blog,WebP vs PNG Complete Guide,/blog/webp-vs-png-guide,webp-to-png,ALL,78,3,pending,2025-09-20
3,pillar,Image Format Conversion Hub,/convertmyfile/formats,all-formats,ALL,92,4,pending,2025-09-30
```

### 7.3 schema_snippets.jsonl

```jsonl
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"ConvertMyFile","applicationCategory":"BrowserApplication","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"aggregateRating":{"@type":"AggregateRating","ratingValue":"4.8","ratingCount":"1234"}}
{"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"Is it free?","acceptedAnswer":{"@type":"Answer","text":"Yes, completely free"}}]}
{"@context":"https://schema.org","@type":"HowTo","name":"Convert WebP to PNG","step":[{"@type":"HowToStep","text":"Install extension"},{"@type":"HowToStep","text":"Right-click image"},{"@type":"HowToStep","text":"Select Convert"}]}
```

## 8. Testing Strategy

### 8.1 Unit Tests

```typescript
describe('EntityAuditor', () => {
  test('Extract entities from SERP data', async () => {
    const serpData = mockSERPData();
    const entities = extractor.extractFromSERP(serpData);
    expect(entities).toContainEqual({ 
      canonical: 'webp', 
      variants: ['webp image', 'webp format'] 
    });
  });
  
  test('Calculate coverage score', async () => {
    const page = mockPageSnapshot();
    const score = analyzer.calculateCoverageScore(page, cluster);
    expect(score).toBeCloseTo(65, 1);
  });
});
```

### 8.2 Integration Tests

```typescript
describe('Schema Generation', () => {
  test('Generate valid SoftwareApplication schema', async () => {
    const data = mockProductData();
    const schema = generator.generate('SoftwareApplication', data);
    const validation = validator.validate(schema);
    expect(validation.valid).toBe(true);
  });
  
  test('Detect and report schema issues', async () => {
    const schemas = [duplicateFAQ, missingRequired];
    const lint = validator.lint(schemas);
    expect(lint.issues).toHaveLength(2);
  });
});
```

### 8.3 End-to-End Tests

```bash
# Test entity audit workflow
npm test -- --testNamePattern="Entity audit complete workflow"

# Test schema generation and validation
npm test -- --testNamePattern="Schema generation with validation"

# Test content planning
npm test -- --testNamePattern="Content calendar generation"
```

## 9. Performance Targets

| Operation | Warm Cache | Cold Cache |
|-----------|------------|------------|
| Entity Audit | <30s | <60s |
| Schema Generation | <10s | <20s |
| Content Planning | <20s | <40s |
| Link Optimization | <15s | <30s |
| **Total** | **<60s** | **<120s** |

## 10. Guardrails & Constraints

### 10.1 Entity Extraction
- Minimum SERP pages: 5 for reliable extraction
- Entity normalization: Lowercase, singular, stop-word removal
- Synonym mapping: Product-specific dictionary

### 10.2 Schema Generation
- No schema on noindex pages
- Minimum content: 250 words
- Claims validation applied to all text fields
- Duplicate detection across FAQ questions

### 10.3 Content Planning
- Maximum recommendations per cluster: 5
- Effort scores: LP update (2), Blog (3), Pillar (4)
- Priority formula: impact / effort

### 10.4 Link Optimization
- Maximum new links per page: 3
- Anchor text diversity: Exact (30%), Partial (40%), Semantic (30%)
- No self-links or circular references
- Target URL health check required

## 11. Success Criteria

### Acceptance Tests
- [ ] Entity audit identifies 5+ gaps per cluster
- [ ] Coverage scores calculated within 5% accuracy
- [ ] Schema generation produces valid JSON-LD for all 5 types
- [ ] Schema validator catches all structural issues
- [ ] Content calendar sorted by impact/effort ratio
- [ ] Link opportunities include varied anchor text
- [ ] Performance targets met (<60s warm, <120s cold)
- [ ] All outputs validate against contracts

### Production Readiness
- [ ] Database migrations tested and reversible
- [ ] Cache strategy implemented for SERP data
- [ ] Error handling for missing data sources
- [ ] Documentation updated with v1.8 features
- [ ] CLI commands integrated and tested

## 12. Risk Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| SERP data unavailable | High | Cache with 7-day TTL, fallback to keywords |
| Entity extraction noise | Medium | Importance scoring, manual review option |
| Schema validation errors | Low | Comprehensive validator, dry-run mode |
| Performance degradation | Low | Caching, batch processing, async operations |

## 13. Documentation Updates

### Files to Update
- `README.md` - Add v1.8 entity audit commands
- `CLAUDE.md` - Update with v1.8 features
- `docs/entity-audit-guide.md` - New user guide
- `docs/schema-reference.md` - Schema template documentation

### Example Documentation

```markdown
## Entity Coverage Analysis (v1.8)

Analyze topical coverage and generate content roadmaps:

### Quick Start
```bash
# Audit entity coverage
seo-ads entity-audit --product palettekit

# Generate schema
seo-ads schema-emit --product palettekit --validate

# Create content roadmap
seo-ads content-roadmap --product palettekit
```

### Features
- Multi-source entity extraction (SERP, keywords, reviews)
- Coverage scoring against competitors
- 5 schema types with validation
- Prioritized content calendar
- Internal linking opportunities
```

## Timeline

**Day 1**: Entity auditor + database schema  
**Day 2**: Schema generator + validator  
**Day 3**: Content planner + calendar  
**Day 4**: Link optimizer + FAQ extractor  
**Day 5**: Integration + testing + documentation  

Total: **3-5 days** (depending on testing depth)

## Conclusion

v1.8 significantly enhances the SEO Ads Expert's organic optimization capabilities by adding comprehensive entity coverage analysis, structured data generation, and strategic content planning. The implementation builds seamlessly on the existing v1.0-1.7 infrastructure while introducing powerful new features for raising the organic ceiling through data-driven content and schema optimization.

The modular architecture ensures maintainability, the performance targets guarantee responsive operation, and the comprehensive testing strategy ensures production readiness. With automated gap detection, validated schema generation, and prioritized content roadmaps, v1.8 delivers enterprise-grade SEO intelligence.