# SEO & Google Ads Expert Tool v1.1 - Implementation Plan
*Revised with GPT-5 Expert Feedback*

## Overview

v1.1 transforms the SEO Ads Expert from a **planning tool** to an **action-ready deployment system** by eliminating manual reformatting friction and adding quality gates to prevent campaign failures.

**Core Goal**: Make plans instantly actionable without any manual reformatting while reducing bad recommendations through automated quality checks.

**Timeline**: 3-4 days (revised with enhanced scope)  
**Phase**: Output Hardening & Zero-Friction Imports  
**Status**: Ready to implement (v1.0 production-ready ✅)

## GPT-5 Expert Feedback Integration

**Key Insights Applied**:
- **Ground-truth CSV schemas** from real Ads Editor exports (prevents 90% of import failures)
- **Asset-based extensions** (modern Sitelinks/Callouts/Structured Snippets approach)
- **Use-case level claims validation** (format-specific vs product-level)  
- **Enhanced URL health checks** (robots.txt, redirect chains, soft-404s)
- **Byte-level determinism** (CSV column order, line endings, snapshot testing)
- **Realistic performance budgets** (≤2min cold / ≤60s warm vs optimistic 30s)

## v1.1 Project Structure Extensions

Building on existing v1.0 structure:

```
/Users/.../lba/infrastructure/tools/seo-ads-expert/
├── src/
│   ├── writers/
│   │   ├── writers.ts          # Existing v1.0 writers
│   │   ├── ads-editor.ts       # NEW: Ads Editor CSV generators
│   │   └── ads-script.ts       # NEW: Google Ads Script generator
│   ├── validators/
│   │   ├── validation.ts       # Existing v1.0 validation
│   │   ├── url-health.ts       # NEW: HTTP + HTML parsing
│   │   └── claims.ts           # NEW: Marketing claim validation
│   └── utils/
│       ├── cache.ts            # Existing v1.0 caching
│       ├── diff.ts             # NEW: Plan comparison logic
│       └── deterministic.ts    # NEW: Consistent output formatting
├── plans/[product]/[date]/     # Existing v1.0 outputs PLUS:
│   ├── ads_editor/             # NEW: Direct import CSVs (ground-truth schema)
│   │   ├── campaigns.csv       # Campaign structure + budgets + geo targeting
│   │   ├── ad_groups.csv       # Ad groups + final URLs + CPC defaults
│   │   ├── keywords_exact.csv  # Exact match keywords + UTM ValueTrack
│   │   ├── keywords_phrase.csv # Phrase match keywords + UTM ValueTrack
│   │   ├── ads_rsa.csv         # RSAs + headline pinning + asset associations
│   │   ├── assets_sitelinks.csv # Sitelink assets for campaign-level reuse
│   │   ├── assets_callouts.csv  # Callout assets ("Free tier", "Privacy-first")
│   │   ├── assets_structured.csv # Structured Snippets ("Features: WebP→PNG")
│   │   ├── asset_associations.csv # Link assets to campaigns/ad groups  
│   │   ├── shared_negatives.csv  # Shared negative lists per product
│   │   └── negative_associations.csv # Link shared lists to campaigns
│   ├── exports/
│   │   ├── ads_script_[product].js  # NEW: Google Ads Script with guardrails
│   │   └── utm_template.txt         # NEW: Canonical UTM parameters
│   ├── url_health.json         # NEW: Enhanced landing page quality gates  
│   ├── golden_sample/          # NEW: Ground-truth CSV samples for testing
│   └── diff.json               # NEW: Semantic changes vs previous run
└── tests/
    ├── snapshots/              # NEW: Data contract protection
    └── __snapshots__/          # NEW: Vitest snapshot files
```

## v1.1 Implementation Tasks

### Task 1: Ground-Truth CSV Schema & Data Contracts  
**Time**: 4 hours (revised - includes real Ads Editor export)  
**Priority**: Critical Foundation

- [ ] **Step 0: Create Ground-Truth Export** (1.5 hours):
  - [ ] Set up scratch Google Ads account with minimal campaign structure:
    - 1 campaign, 2 ad groups, exact/phrase keywords, RSA with pinning
    - Sitelinks, Callouts, Structured Snippets as Assets + Associations
    - 1 Shared Negative List attached to campaign
  - [ ] Export from Ads Editor → "Export selected campaigns and ad groups"
  - [ ] Save ground-truth CSVs in `plans/golden_sample/` directory
  - [ ] Document exact column names, order, and data types

- [ ] **Schema Lock-in** (1.5 hours):
  - [ ] Create `src/schemas/csv-schemas.ts` with column registries per CSV type
  - [ ] Define byte-level validation for CSV headers and data types
  - [ ] Lock JSON schemas for `ads.json`, `keywords.csv`, `seo_pages.md`
  - [ ] Add version markers and format validation to all outputs

- [ ] **Byte-Level Snapshot Testing** (1 hour):
  - [ ] Install vitest snapshot testing dependencies  
  - [ ] Create `tests/snapshots/csv-bytes.test.ts` (tests raw CSV bytes)
  - [ ] Create `tests/snapshots/json-structure.test.ts` (tests parsed objects)
  - [ ] Generate baseline snapshots using ConvertMyFile test data
  - [ ] Test that schema changes break byte-level snapshots

**Files Modified**: `package.json`, new `src/schemas/`, new ground-truth samples  
**Deliverable**: Import-failure-proof CSV generation + regression protection

---

### Task 2: Deterministic Output System (GPT-5 Enhanced)
**Time**: 3 hours (revised - enhanced scope)  
**Priority**: High (enables meaningful diffs)

- [ ] **Column Registry System** (1.5 hours):
  - [ ] Create `src/utils/deterministic.ts` with CSV column registries
  - [ ] Implement `enforceColumnOrder(data, csvType)` per CSV type
  - [ ] Implement `fixDecimals(value, precision=2)` with Number.toFixed(2)
  - [ ] Add `utf8WindowsLineEndings()` (\r\n) without BOM for CSV compatibility
  - [ ] Create per-file-type formatters (campaigns.csv vs keywords.csv)

- [ ] **Apply to All Writers** (1.5 hours):
  - [ ] Update existing `writers.ts` to use deterministic utilities
  - [ ] Ensure keywords sorted by: score desc → alphabetically → market
  - [ ] Pin all floats to exactly 2 decimal places across all outputs
  - [ ] Freeze array ordering: campaigns → ad groups → keywords → assets
  - [ ] Test byte-identical outputs across multiple runs (critical!)

**Files Modified**: `src/writers/writers.ts`, new `src/utils/deterministic.ts`  
**Deliverable**: Byte-identical outputs + meaningful diffs + Windows CSV compatibility

---

### Task 3: Enhanced URL Health Checker & Quality Gates (GPT-5 Expanded)
**Time**: 6 hours (revised - comprehensive health checks)  
**Priority**: Critical (prevents campaign disasters)

- [ ] **Comprehensive HTTP Health Checker** (3.5 hours):
  - [ ] Create `src/validators/url-health.ts` with robust health checks:
    - HTTP status (200, 3xx redirect chains up to 5 hops, 4xx/5xx failures)
    - HTML parsing: `<title>`, `<h1>`, canonical, robots meta, noindex/nofollow
    - Simple word count + content validation (minimum viable content)
    - Soft-404 heuristics: HTTP 200 but title contains "404/Not Found" or <100 words
    - Meta refresh detection (treat as hard fail)
  - [ ] **robots.txt Integration**: Parse and check if URL path is disallowed
  - [ ] **Advanced Checks**: Canonical loops, off-site canonicals, TTFB warnings
  - [ ] **Multi-market Support**: hreflang presence for AU/US/GB pages
  - [ ] **Performance Gates**: Optional Lighthouse-lite (TTFB >1.5s, missing image dimensions)

- [ ] **Quality Gates Integration** (2.5 hours):
  - [ ] Generate comprehensive `url_health.json` for all landing pages
  - [ ] **Hard Fail Conditions**: 4xx/5xx, noindex, robots.txt disallow, missing H1, soft-404s
  - [ ] **Warning Conditions**: Redirect chains, canonical issues, slow TTFB, hreflang missing
  - [ ] Block ad group mapping for hard failures with clear error messages
  - [ ] Add health summary and warnings to `summary.json`  
  - [ ] Update orchestrator with health check integration + `--skip-health-check` override

**Files Modified**: `src/orchestrator.ts`, new `src/validators/url-health.ts`  
**Deliverable**: Comprehensive landing page quality assurance (zero broken campaigns)

---

### Task 4: Modern Ads Editor CSV Export System (GPT-5 Enhanced)
**Time**: 8 hours (revised - comprehensive asset-based approach)  
**Priority**: High (immediate ROI - zero manual formatting)

- [ ] **Asset-Based CSV Writers** (5 hours):
  - [ ] Create `src/writers/ads-editor.ts` with ground-truth schema compliance
  - [ ] Implement CSV generators for all 11 required files:
    - `campaigns.csv` - Structure + budgets + geo targeting + device modifiers
    - `ad_groups.csv` - Ad groups + final URLs + CPC defaults (if non-Smart bidding)
    - `keywords_exact.csv` - Exact match + UTM ValueTrack parameters
    - `keywords_phrase.csv` - Phrase match + UTM ValueTrack parameters  
    - `ads_rsa.csv` - RSAs + headline pinning + 12-15 headlines/3-4 descriptions
    - `assets_sitelinks.csv` - Sitelink assets for campaign-level reuse
    - `assets_callouts.csv` - Callouts ("Free tier", "Privacy-first", "No login")
    - `assets_structured.csv` - Structured Snippets ("Features: WebP→PNG, PDF↔JPG")
    - `asset_associations.csv` - Link assets to campaigns/ad groups
    - `shared_negatives.csv` - Shared negative lists per product
    - `negative_associations.csv` - Associate shared lists with campaigns

- [ ] **UTM ValueTrack Integration** (1 hour):
  - [ ] Generate canonical UTM template with ValueTrack parameters:
    `utm_source=google&utm_medium=cpc&utm_campaign={campaignid}&utm_content={adgroupid}-{creative}&utm_term={keyword}&matchtype={matchtype}`
  - [ ] Apply to all final URLs in keywords and ad groups
  - [ ] Export standalone `utm_template.txt` for manual configuration

- [ ] **Ground-Truth Validation & Testing** (2 hours):
  - [ ] Mirror exact column order from ground-truth samples
  - [ ] Ensure RSAs have exactly one pinned "Chrome Extension" headline per ad group
  - [ ] Test import into Google Ads Editor (round-trip validation)
  - [ ] Verify UTF-8 encoding with \r\n line endings (no BOM)
  - [ ] Create unit test comparing generated vs golden sample structure

**Files Modified**: `src/orchestrator.ts`, new `src/writers/ads-editor.ts`, golden samples  
**Deliverable**: 100% Google Ads Editor import success rate with modern asset management

---

### Task 5: Google Ads Script Generator with Enhanced Guardrails (GPT-5 Enhanced)
**Time**: 4 hours (revised - comprehensive safety system)  
**Priority**: Medium-High (safe deployment testing)

- [ ] **Enhanced Ads Script Writer** (2.5 hours):
  - [ ] Create `src/writers/ads-script.ts` with production-grade safety constraints
  - [ ] **Baked-in Safety Constants**:
    - `const MAX_DAILY_BUDGET_AUD = 10;` (refuse unless `ALLOW_HIGH_BUDGET=true` flag)
    - All campaigns created in PAUSED state by default
    - Desktop-only device targeting (mobile -100% bid modifier)
    - Geo targeting: AU/US/GB via geo constants (fail on unknown markets)
    - Apply label `LBA_SEO_ADS_EXPERT_<yyyy-mm-dd>` to all entities (audit/rollback)
  - [ ] **Dry-Run Mode**: When `DRY_RUN=true`, output JSON diff without mutations
  - [ ] Generate complete campaign structure matching CSV exports

- [ ] **Integration & Advanced Safety** (1.5 hours):
  - [ ] Generate `exports/ads_script_[product].js` with comprehensive headers
  - [ ] Add "REVIEW BEFORE RUN" warnings and execution checklist
  - [ ] Include plan metadata, budget breakdown, and change summary as comments
  - [ ] **URL Health Integration**: Refuse to run if any URL failed health checks
  - [ ] Test script loads in Google Ads Scripts without syntax errors
  - [ ] Create dry-run test that outputs expected changes without execution

**Files Modified**: `src/orchestrator.ts`, new `src/writers/ads-script.ts`  
**Deliverable**: Production-safe campaign deployment with comprehensive guardrails

---

### Task 6: Semantic Plan Diffing System (GPT-5 Enhanced) 
**Time**: 4 hours (revised - enhanced semantic analysis)  
**Priority**: Medium-High (enables continuous improvement)

- [ ] **Enhanced Diff Engine** (2.5 hours):
  - [ ] Create `src/utils/diff.ts` with semantic comparison logic
  - [ ] **Keyword-Level Changes**: added/removed/score_changed/volume_updated/source_changed
  - [ ] **Ad Group Changes**: new/removed/landing_page_changed/headline_modified/budget_adjusted
  - [ ] **Content Changes**: page briefs new/updated/removed with change reasons
  - [ ] **SERP Intelligence**: Track blocker changes per cluster (AI Overview appeared/disappeared)
  - [ ] **Asset Changes**: Sitelinks/Callouts/Structured Snippets added/removed/modified
  - [ ] **Semantic RSA Analysis**: Headlines changed because 3 new headlines added (list specifics)

- [ ] **Advanced Diff Integration** (1.5 hours):
  - [ ] Generate comprehensive `diff.json` with change categorization
  - [ ] **Change Impact Scoring**: High/Medium/Low impact changes for prioritization
  - [ ] Handle first run gracefully with "baseline created" messaging
  - [ ] **Console Output**: Formatted diff summary with color coding
  - [ ] **SERP Drift Tracking**: Alert on significant SERP feature changes
  - [ ] Add detailed diff metadata and change statistics to `summary.json`

**Files Modified**: `src/orchestrator.ts`, new `src/utils/diff.ts`  
**Deliverable**: Intelligent plan evolution tracking with actionable insights

---

### Task 7: Use-Case Level Claims Validation & Guard System (GPT-5 Enhanced)
**Time**: 3 hours (revised - use-case specific validation)  
**Priority**: Medium (compliance safety)

- [ ] **Use-Case Specific Claims Validator** (2 hours):
  - [ ] Create `src/validators/claims.ts` with granular validation
  - [ ] **Enhanced Product YAML Structure**: Move from product-level to use-case level:
    ```yaml
    claims_validation:
      webp_to_png:
        local_processing: true
        privacy_first: true  
        no_uploads_required: true
      heic_to_jpg:
        local_processing: false    # server processing required
        privacy_first: false       # external service used
        no_uploads_required: false # uploads needed for conversion
    ```
  - [ ] Implement validation per cluster/use-case instead of product-wide
  - [ ] Generate cluster-specific claim validation reports
  - [ ] Add use-case validation warnings with specific remediation steps

- [ ] **Intelligent Content Filtering** (1 hour):
  - [ ] **Per-Cluster Filtering**: Redact claims in headlines/descriptions by use-case
  - [ ] **SEO Brief Filtering**: Remove invalid claims from landing page briefs per cluster  
  - [ ] **Smart Rewriting**: Replace invalid claims with validated alternatives when possible
  - [ ] Add claim validation details to `summary.json` with cluster breakdown

**Files Modified**: `src/writers/writers.ts`, `src/writers/ads-editor.ts`, product YAML, new `src/validators/claims.ts`  
**Deliverable**: Use-case compliant marketing copy with granular validation

---

### Task 8: Enhanced Localization System (GPT-5 Enhanced)
**Time**: 3 hours (revised - comprehensive market support)  
**Priority**: Medium (market expansion ready)

- [ ] **Market-Specific SERP Integration** (1.5 hours):
  - [ ] Ensure all SERP connector calls use precise `market_localization` gl/hl parameters
  - [ ] Add market validation with specific locale combinations (AU: gl=au,hl=en-AU)  
  - [ ] **Market-Specific Final URLs**: Support localized landing pages (/au/, /us/, /gb/)
  - [ ] Include market-specific SERP data and competitor intelligence in outputs
  - [ ] Validate geo targeting matches SERP market selection

- [ ] **Comprehensive Localized Content** (1.5 hours):
  - [ ] **Market-Specific SEO Briefs**: Generate localized title/meta suggestions per market
  - [ ] **Spelling & Terminology**: Handle regional differences ("colour" vs "color" for PaletteKit)
  - [ ] **Currency & Format Hints**: Include market-appropriate currency symbols and date formats
  - [ ] **Cultural Adaptation**: Adjust value propositions and messaging per market
  - [ ] **Market-Specific Keywords**: Include regional keyword variations in clustering
  - [ ] Generate separate landing page briefs per market when URL structure supports it

**Files Modified**: `src/connectors/rapid-serp.ts`, `src/writers/writers.ts`, `src/writers/ads-editor.ts`  
**Deliverable**: Full multi-market campaign deployment with localized content and targeting

---

### Task 9: Enhanced CLI & Error Handling (GPT-5 Enhanced)
**Time**: 3 hours (revised - comprehensive CLI features)  
**Priority**: Medium (polish and UX)

- [ ] **Advanced CLI Commands** (1.5 hours):
  - [ ] Add `--format ads-editor` flag to generate only CSV exports (skip JSON/MD)
  - [ ] Add `--export utm-template` to emit canonical UTM suffix for copy-paste
  - [ ] Add `--validate-only` to run schema + URL health + claims without artifacts (fast precheck)
  - [ ] Add `--skip-health-check` for development testing and emergency runs
  - [ ] Add `--diff-only` to generate diff against previous run without full re-run
  - [ ] Add `--dry-run` mode for Google Ads Script generation (outputs changes without execution)

- [ ] **Production-Grade Error Handling** (1.5 hours):
  - [ ] **Partial Failure Resilience**: Continue plan generation with degraded data when APIs partially fail
  - [ ] **Enhanced Error Messages**: Specific remediation steps for CSV validation failures
  - [ ] **Retry Logic**: Intelligent retry for HTTP health checks with exponential backoff
  - [ ] **Progress Indicators**: Real-time progress for URL health checks and SERP calls
  - [ ] **Timeout Management**: Configurable timeouts with reasonable defaults
  - [ ] **Quota Warnings**: Proactive warnings when approaching API rate limits

**Files Modified**: `src/cli.ts`, `src/orchestrator.ts`, `src/validators/url-health.ts`  
**Deliverable**: Enterprise-grade CLI with comprehensive error handling and user experience

---

## v1.1 Success Criteria (Pass/Fail Gates)

### **Must Pass**
- [ ] **Ads Editor CSVs import without errors** - Test with real Google Ads Editor
- [ ] **RSAs show one pinned "Chrome Extension" headline per ad group** - Verify in imports
- [ ] **No ad group points to failed page in url_health.json** - Quality gate enforcement
- [ ] **diff.json exists and lists changes** - All five artifacts tracked
- [ ] **All snapshot tests pass** - Data contract protection working
- [ ] **Deterministic output** - Multiple runs produce identical files

### **Quality Gates (GPT-5 Revised)**
- [ ] **URL Health**: 0% of ad groups map to hard-fail pages (4xx/5xx/noindex/robots disallow/soft-404)
- [ ] **CSV Format**: 100% successful Google Ads Editor imports (round-trip validation)
- [ ] **Claim Compliance**: 0 invalid marketing claims in outputs per use-case validation
- [ ] **Performance**: Plan generation ≤2 minutes cold cache / ≤60 seconds warm cache (realistic targets)
- [ ] **Asset Integration**: Callouts/Structured Snippets properly associated at campaign level
- [ ] **Byte Consistency**: Multiple runs produce identical CSV/JSON files (deterministic output)

## Testing Strategy

### **Integration Testing**
- [ ] End-to-end test with ConvertMyFile product
- [ ] Verify all CSV files import successfully into Google Ads Editor  
- [ ] Test Google Ads Script runs without syntax errors (don't execute)
- [ ] Validate URL health checks against real and broken URLs

### **Snapshot Testing**
- [ ] Baseline snapshots for all output formats
- [ ] Schema validation tests for data contracts
- [ ] Regression tests for deterministic output

### **Manual Validation**
- [ ] Import generated CSVs into Google Ads Editor
- [ ] Review generated Google Ads Script for safety guardrails
- [ ] Verify diff.json accuracy by making deliberate changes

## Risk Mitigation

### **Technical Risks**
- **CSV Format Compatibility**: Test with real Google Ads Editor early
- **URL Health Timeouts**: Implement reasonable timeout + retry logic
- **Schema Changes**: Snapshot tests catch breaking changes immediately

### **Quality Risks**  
- **False Positive Health Checks**: Add manual override flags
- **Over-aggressive Claim Filtering**: Conservative approach, warn before filtering
- **Deterministic Output Bugs**: Comprehensive sorting tests

## Implementation Order

**Week 1 (Critical Path)**:
1. Task 1: Data Contracts (foundation for everything)
2. Task 2: Deterministic Output (enables meaningful diffs) 
3. Task 3: URL Health Checker (prevents disasters)
4. Task 4: Ads Editor CSVs (immediate value)

**Week 1-2 (High Value)**:
5. Task 5: Google Ads Script (deployment bridge)
6. Task 6: Plan Diffing (continuous improvement)

**Week 2 (Polish)**:
7. Task 7: Claims Validation (compliance)
8. Task 8: Enhanced Localization (market expansion)
9. Task 9: CLI Enhancements (UX polish)

## Post-v1.1 Readiness

**v1.1 → v1.2 Enablers**:
- Plan diffing enables SERP drift detection
- URL health checks enable performance monitoring  
- Deterministic output enables reliable automation
- Data contracts prevent regressions during v1.2 iteration

**v1.1 → v1.3 Enablers**:
- Google Ads Script provides safe API testing ground
- Quality gates prevent automated deployment disasters
- Claims validation ensures compliant automated campaigns
- CSV exports prove format compatibility before API writes

## Total Estimated Time: 38 hours (3-4 days with focused development) 

**GPT-5 Enhanced Scope Breakdown**:
- **Day 1**: Tasks 1-2 (Ground-truth schemas, deterministic output) - 7 hours  
- **Day 2**: Task 3 (Enhanced URL health checks) - 6 hours
- **Day 3**: Task 4 (Modern asset-based CSV system) - 8 hours
- **Day 4**: Tasks 5-6 (Enhanced Ads Script, semantic diffing) - 8 hours
- **Day 5**: Tasks 7-9 (Use-case claims, localization, CLI polish) - 9 hours

**Critical Path Priority**:
1. **Week 1 Foundation**: Tasks 1-3 (Ground-truth + Health gates) 
2. **Week 1 Value**: Task 4 (Asset-based CSV exports)
3. **Week 2 Advanced**: Tasks 5-9 (Scripts + Intelligence)  

## Immediate Next Steps (GPT-5 Enhanced)

1. **Step 0: Create Ground-Truth Export** - Set up scratch Ads account and export real CSV samples
2. **Review v1.0 codebase** - Confirm all integration points for seamless enhancement
3. **Start with Task 1** (Ground-truth schemas) - Critical foundation for import success
4. **Test early and continuously** - CSV round-trip validation after each major task
5. **Document schema changes** - Track any v1.0 → v1.1 data format migrations

## GPT-5 Expert Acceptance Tests

**Before calling v1.1 "complete", these must pass**:
- [ ] **Ads Editor Round-Trip**: Import CSVs → re-export → diff shows only value changes (no schema changes)
- [ ] **Script Dry-Run**: Google Ads Script loads without syntax errors + prints sane diff + refuses on URL health fails  
- [ ] **Claims Killer Test**: Set `local_processing=false` for one cluster → verify tool removes "no uploads" claims
- [ ] **Determinism Test**: Two consecutive runs with identical inputs produce byte-identical CSVs/JSON/MD files

This plan transforms the tool from "good planning data" to "deployment-ready campaigns" with bulletproof import compatibility and comprehensive quality gates, while building essential infrastructure for v1.2-v1.3 advanced automation features.